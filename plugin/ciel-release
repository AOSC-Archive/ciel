#!/bin/bash
MOUNT_POINT="$(ciel mount $*)"
WORKDIR="$PWD"
XZ_PARAM="-T 0 -9 -e --lzma2=preset=9e,nice=273"
DATE="$(date +'%Y%m%d')"
ARCH="$(dpkg-architecture -qDEB_BUILD_ARCH)"

cd "$MOUNT_POINT"
# Compress BuildKit.
tar cvf - *  | xz "$XZ_PARAM" > "$WORKDIR"/aosc-os-buildkit_"${DATE}"_"${ARCH}".tar.xz
# Generate SHA256 checksum.
sha256sum aosc-os-buildkit_"${DATE}"_"${ARCH}".tar.xz{,.sha256sum}

cd "$WORKDIR"
umount "$MOUNT_POINT"
rmdir "$MOUNT_POINT"
