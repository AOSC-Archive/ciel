#!/bin/bash

# Strict mode, assuming Autobuild3 and ACBS catches errors properly.
set -e
ciel shell "acbs-build $*"
# And turn it off.
set +e

MOUNT_POINT=$(ciel mount) || exit $?

if ls /os-* 1> /dev/null 2>&1; then
	cp -rpv "$MOUNT_POINT"/os-* ./
fi
if [[ -e "$MOUNT_POINT"/var/log/apt/history.log ]]; then
	cp -pv "$MOUNT_POINT"/var/log/apt/history.log ./
fi
umount "$MOUNT_POINT"
rm -rfv "$MOUNT_POINT"

# Merge cache, namely APT packages and catalogues.
ciel merge-cache
ciel clean
